Address deduplicator
====================

Merge multiple address databases and remove duplicates.


Usage
-----

Addresses can be loaded from OSM and OpenAddresses as follows:

```bash
cargo run --release -- --osm path/to/osm.pbf --openaddresses path/to/openaddresses
```

Addresses can also be loaded from an SQLite file previously generated by an
importer.

```bash
cargo run --release -- --osm-db path/to/osm_as_sqlite.db --openaddresses-db path/to/openaddresses_as_sqlite.db
```

This will output a CSV file using the same format as OpenAddresses.

If you want more information on the available options, use `-h` or `--help`:

```bash
cargo run --release -- -h
```

Duplicate criteria
------------------

Two addresses are considered duplicates if one of these two properties is true:

 - The distance between the two addresses is less than 100 meters and according
   to libpostal:
     - have the same house number
     - are likely to be in the same street (if there is less than 10 meters
       between the two addresses, libpostal is allowed to only output
       `PossibleDuplicate` for street name)

 - According to libpostal, the two addresses have:
     - the same house number
     - the same street name
     - the same city name
     - the same postal code
     - they are distant of less than 1km


Implementation details
----------------------

The deduplication is done through two steps:

 1. First, an SQLite database is built, with a table containing all addresses
    and another table containing hashes computed for these addresses using
    libpostal.

 2. Then, the pairs of addresses with conflicting hashes are extracted from the
    database, for each of these pairs a more accurate criterion is applied to
    decide if it is actually a duplicate. Finally, for each actual duplicate,
    one of the two addresses is removed from the database.
